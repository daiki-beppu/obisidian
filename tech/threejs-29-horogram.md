---
title: 29-horogram
date: 2024/08/22
updated: 2024/09/01
---

# ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®åˆ¶ä½œ

- [ä¸‹æº–å‚™](#ä¸‹æº–å‚™)
- [ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…](#ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…)
  - [ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½œæˆ](#ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½œæˆ)
  - [å‡ºåŠ›çµæœ](#å‡ºåŠ›çµæœ)
  - [ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨](#ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨)
  - [å‡ºåŠ›çµæœ](#å‡ºåŠ›çµæœ-1)
- [ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®å®Ÿè£…](#ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®å®Ÿè£…)
  - [ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®æ¦‚è¦](#ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®æ¦‚è¦)
    - [3D ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«ãŠã‘ã‚‹ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®é‡è¦æ€§](#3d-ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«ãŠã‘ã‚‹ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®é‡è¦æ€§)
  - [ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—](#ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—)
    - [è¦–ç·šæ–¹å‘ã®è¨ˆç®—](#è¦–ç·šæ–¹å‘ã®è¨ˆç®—)
    - [ãƒ‰ãƒƒãƒˆç©ã®è¨ˆç®—](#ãƒ‰ãƒƒãƒˆç©ã®è¨ˆç®—)
  - [ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®å•é¡Œç‚¹ã¨ä¿®æ­£](#ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®å•é¡Œç‚¹ã¨ä¿®æ­£)
    - [å•é¡Œã®ä¿®æ­£: ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—å€¤ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›è»¢ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¦ã—ã¾ã†](#å•é¡Œã®ä¿®æ­£-ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—å€¤ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›è»¢ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¦ã—ã¾ã†)
    - [å•é¡Œã®ä¿®æ­£: è¡¨é¢ã«è¦å‰‡çš„ãªæ¨¡æ§˜ãŒè¦‹ãˆã‚‹](#å•é¡Œã®ä¿®æ­£-è¡¨é¢ã«è¦å‰‡çš„ãªæ¨¡æ§˜ãŒè¦‹ãˆã‚‹)
- [ãƒ›ãƒ­ã‚°ãƒ©ãƒ åŠ¹æœã®å®Œæˆ](#ãƒ›ãƒ­ã‚°ãƒ©ãƒ åŠ¹æœã®å®Œæˆ)
  - [ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®çµ„ã¿åˆã‚ã›](#ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®çµ„ã¿åˆã‚ã›)
  - [èƒŒé¢ã®è¡¨ç¤ºã¨ä¿®æ­£](#èƒŒé¢ã®è¡¨ç¤ºã¨ä¿®æ­£)
  - [æ·±åº¦ãƒãƒƒãƒ•ã‚¡ã®èª¿æ•´](#æ·±åº¦ãƒãƒƒãƒ•ã‚¡ã®èª¿æ•´)
  - [ãƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®è¨­å®š](#ãƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®è¨­å®š)
  - [ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•(æ¸›è¡°åŠ¹æœ)](#ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•æ¸›è¡°åŠ¹æœ)
  - [ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ](#ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ)
- [è‰²ã®å¤‰æ›´](#è‰²ã®å¤‰æ›´)
  - [ãƒ‡ãƒãƒƒã‚° UI ã®è¿½åŠ ](#ãƒ‡ãƒãƒƒã‚°-ui-ã®è¿½åŠ )
- [ã‚°ãƒªãƒƒãƒåŠ¹æœã®å®Ÿè£…](#ã‚°ãƒªãƒƒãƒåŠ¹æœã®å®Ÿè£…)
  - [ãƒ©ãƒ³ãƒ€ãƒ é–¢æ•°ã®ä½œæˆ](#ãƒ©ãƒ³ãƒ€ãƒ é–¢æ•°ã®ä½œæˆ)
  - [ã™ã¹ã¦ã®é ‚ç‚¹ã«ã‚°ãƒªãƒƒãƒåŠ¹æœã‚’é©ç”¨](#ã™ã¹ã¦ã®é ‚ç‚¹ã«ã‚°ãƒªãƒƒãƒåŠ¹æœã‚’é©ç”¨)
  - [ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¿®æ­£](#ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¿®æ­£)
  - [ä¸‹ã‹ã‚‰ä¸Šã¸ã¨æ³¢ã®ã‚ˆã†ã«å¤‰åŒ–ã•ã›ã‚‹](#ä¸‹ã‹ã‚‰ä¸Šã¸ã¨æ³¢ã®ã‚ˆã†ã«å¤‰åŒ–ã•ã›ã‚‹)
  - [ã‚°ãƒªãƒƒãƒåŠ¹æœã®é »åº¦ã‚’èª¿æ•´](#ã‚°ãƒªãƒƒãƒåŠ¹æœã®é »åº¦ã‚’èª¿æ•´)
  - [ç•°ãªã‚‹å‘¨æ³¢æ•°ã‚’åˆ©ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’è¿½åŠ ](#ç•°ãªã‚‹å‘¨æ³¢æ•°ã‚’åˆ©ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’è¿½åŠ )
- [ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ³ã‚¯ã®åˆ†é›¢](#ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ³ã‚¯ã®åˆ†é›¢)
  - [æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ](#æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ)

> [!NOTE]
>
> ã“ã¡ã‚‰ã®å†…å®¹ã¯
> Three.js v0.166.1 ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

## ä¸‹æº–å‚™

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

<details>
<summary>package.json(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```json
{
  "name": "threejs-journey-exercise",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build"
  },
  "devDependencies": {
    "@biomejs/biome": "1.8.3",
    "vite": "^5.3.3",
    "vite-plugin-glsl": "^1.3.0",
    "vite-plugin-restart": "^0.4.1"
  },
  "dependencies": {
    "lil-gui": "^0.19.2",
    "three": "^0.166.1"
  }
}
```

</details>

<details>
<summary>.jsãƒ•ã‚¡ã‚¤ãƒ«(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```js
import GUI from "lil-gui";
import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import fragmentShader from "./shaders/holographic/fragment.glsl";
import vertexShader from "./shaders/holographic/vertex.glsl";

// ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
const gui = new GUI();
const canvas = document.querySelector("canvas.webgl");
const scene = new THREE.Scene();
const gltfLoader = new GLTFLoader();
const sizes = {
  width: window.innerWidth,
  height: window.innerHeight,
};

window.addEventListener("resize", () => {
  sizes.width = window.innerWidth;
  sizes.height = window.innerHeight;

  camera.aspect = sizes.width / sizes.height;
  camera.updateProjectionMatrix();

  renderer.setSize(sizes.width, sizes.height);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
});

// ã‚«ãƒ¡ãƒ©
const camera = new THREE.PerspectiveCamera(
  25,
  sizes.width / sizes.height,
  0.1,
  100
);
camera.position.set(7, 7, 7);
scene.add(camera);

// ã‚ªãƒ¼ãƒ“ãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
const controls = new OrbitControls(camera, canvas);
controls.enableDamping = true;

// ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
const rendererParameters = {};
rendererParameters.clearColor = "#1d1f2a";

const renderer = new THREE.WebGLRenderer({
  canvas: canvas,
  antialias: true,
});
renderer.setClearColor(rendererParameters.clearColor);
renderer.setSize(sizes.width, sizes.height);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

gui.addColor(rendererParameters, "clearColor").onChange(() => {
  renderer.setClearColor(rendererParameters.clearColor);
});

// ãƒãƒ†ãƒªã‚¢ãƒ«
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
});

// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
// Torus knot
const torusKnot = new THREE.Mesh(
  new THREE.TorusKnotGeometry(0.6, 0.25, 128, 32),
  material
);
torusKnot.position.x = 3;
scene.add(torusKnot);

// Sphere
const sphere = new THREE.Mesh(new THREE.SphereGeometry(), material);
sphere.position.x = -3;
scene.add(sphere);

// Suzanne
let suzanne = null;
gltfLoader.load("./suzanne.glb", (gltf) => {
  suzanne = gltf.scene;
  suzanne.traverse((child) => {
    if (child.isMesh) child.material = material;
  });
  scene.add(suzanne);
});

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const clock = new THREE.Clock();

const tick = () => {
  const elapsedTime = clock.getElapsedTime();

  if (suzanne) {
    suzanne.rotation.x = -elapsedTime * 0.1;
    suzanne.rotation.y = elapsedTime * 0.2;
  }

  sphere.rotation.x = -elapsedTime * 0.1;
  sphere.rotation.y = elapsedTime * 0.2;

  torusKnot.rotation.x = -elapsedTime * 0.1;
  torusKnot.rotation.y = elapsedTime * 0.2;

  controls.update();

  renderer.render(scene, camera);

  window.requestAnimationFrame(tick);
};

tick();
```

</details>

<details>
<summary>. glslãƒ•ã‚¡ã‚¤ãƒ«(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```glsl
// vertex.glsl
void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;
}

```

```glsl
// fragment.glsl
void main() {
  gl_FragColor = vec4(1.0, 0.3, 0.0, 1.0);
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}

```

</details>

## ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…

### ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½œæˆ

[ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å­¦ç¿’ã—ãŸå†…å®¹](https://github.com/daiki-beppu/til/blob/main/til/frontend/3d-graphics/threejs/24-shader-patterns.md#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3-7)ã¨ã‚ˆãä¼¼ã¦ã„ã‚‹ãŒ
ä»Šå›ã¯ **UV åº§æ¨™**ã§ã¯ãªã`modelPosition`ã‚’å‰²ã‚Šå½“ã¦ã‚‹

```glsl
// vertex.glsl ã«è¨˜è¿°
varying vec3 vPosition;

void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;

  // varying ã§ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡
  vPosition = modelPosition.xyz;
}
```

```glsl
// fragment.glsl ã«è¨˜è¿°
varying vec3 vPosition;

void main() {
  // yè»¸æ–¹å‘ã®ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ
  float stripes = mod((
    vPosition.y * 20.0, // * 20.0 ã§ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ã®æ•°ã‚’èª¿æ•´
    1.0 // å€¤ãŒ 1.0 ã«ãªã£ãŸã¨ã 0 ã«æˆ»ã‚‹
    );

  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ã®ã‚¨ãƒƒã‚¸ã‚’é‹­ãã™ã‚‹
  stripes = pow(stripes, 3.0); // pow()ã§ã¹ãä¹—è¨ˆç®—ã‚’è¡Œã„éç·šå½¢å€¤ã«å¤‰æ›ã—ã¦ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’å¼·èª¿
  // 3.0 ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã‚¨ãƒƒã‚¸ã®é‹­ã•ã‚’èª¿æ•´

  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚¢ãƒ«ãƒ•ã‚¡å€¤ã¨ã—ã¦ä½¿ç”¨
  gl_FragColor = vec4(vec3(1.0), stripes);

  // Three.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}

```

ã‚¢ãƒ«ãƒ•ã‚¡å€¤ã‚’å¤‰æ›´ã—ã¦ã„ã‚‹ã®ã§ .js ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ†ãƒªã‚¢ãƒ«ã«
`transparent: true`ã®è¿½åŠ ã‚’å¿˜ã‚Œãšã«ï¼

> [!NOTE]
>
> ğŸ“ **Memo**
>
> **ãªãœ UV åº§æ¨™ã§ã¯ãªã `modelPosition`ï¼Ÿ**
>
> UV åº§æ¨™ã¯ 2D å¹³é¢ä¸Šã®ç›¸å¯¾çš„ãªä½ç½®ã‚’è¡¨ã™ã€‚ 3D ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨é¢ã«å¯¾ã—ã¦ã®ã¿é©ç”¨ã•ã‚Œã‚‹ã€‚
> ä»Šå›ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã«å¯¾ã—ã¦é©ç”¨ã•ã›ãŸã„ã®ã§ 3D ç©ºé–“ã«ãŠã‘ã‚‹çµ¶å¯¾ä½ç½®ã§ã‚ã‚‹ `modelPosition`ã‚’ä½¿ç”¨ã™ã‚‹
> ã“ã‚Œã«ã‚ˆã‚Šç‰©ä½“ã®å½¢çŠ¶ã‚„å‘ãã«é–¢ä¿‚ãªãã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œæˆã§ãã‚‹
>
> **ã‚¹ã‚¦ã‚£ã‚ºãƒªãƒ³ã‚°**
>
> `vPosition` ã¯ `vec3` ã ãŒ `modelPosition` ã¯ `vec4` ãªã®ã§
> `modelPosition.xyz` ã®ã‚ˆã†ã«ã©ã®å€¤ã‚’å–å¾—ã™ã‚‹ã‹æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
> ã“ã‚Œã‚’ã‚¹ã‚¦ã‚£ã‚ºãƒªãƒ³ã‚°ã¨å‘¼ã¶
> ã¾ãŸ`modelPosition.zxy`ã®ã‚ˆã†ã«é †åºã‚’å¤‰æ›´ã—ãŸã‚Šã€`modelPositon.xxyã®ã‚ˆã†ã«`åŒã˜å€¤ã‚’ç¹°ã‚Šè¿”ã—æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹

### å‡ºåŠ›çµæœ

[![Image from Gyazo](https://i.gyazo.com/89e5e8949ac8c1b557154d475b09ff58.png)](https://gyazo.com/89e5e8949ac8c1b557154d475b09ff58)

### ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨

ãƒãƒ†ãƒªã‚¢ãƒ«ã«`uniforms` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã¦
`uTime`, `uAnimationSpeed`ã‚’`new THREE.Uniform(value)`ã§è¿½åŠ 

`uTimeã¯çµŒéæ™‚é–“`ã‚’ã€`uAnimationSpeedã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é€Ÿåº¦`ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

```js
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
  },
  transparent: true,
});
```

tick é–¢æ•°å†…ã§ `uTime.value`ã‚’ `elapsedTime` ã§æ›´æ–°

```js
// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const clock = new THREE.Clock();

const tick = () => {
  const elapsedTime = clock.getElapsedTime();
  material.uniforms.uTime.value = elapsedTime;

  // ...
};

tick();
```

ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ `uTime`, `uAnimationSpeed`ã‚’å–å¾—
`vPositoin.y` ã‹ã‚‰ æ¸›ç®—ã™ã‚‹ã“ã¨ã§ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®ã‚ˆã†ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³(ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸‹ã‹ã‚‰ä¸Šã«å‹•ã)ã‚’é©ç”¨

```glsl
uniform float uTime;
uniform float uAnimationSpeed;

varying vec3 vPosition;

void main() {
  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—
  float stripes = mod(
    (vPosition.y - uTime * uAnimationSpeed) // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨
    * 20.0, 1.0
    );
  stripes = pow(stripes, 3.0);
  gl_FragColor = vec4(vec3(1.0), stripes);

  // Three.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}
```

### å‡ºåŠ›çµæœ

[<a href="https://gyazo.com/299e3fb55025ecf84b138c9509849ad4"><video width="1000" autoplay muted loop playsinline controls><source src="https://i.gyazo.com/299e3fb55025ecf84b138c9509849ad4.mp4" type="video/mp4"/></video></a>](https://i.gyazo.com/299e3fb55025ecf84b138c9509849ad4.gif)

## ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®å®Ÿè£…

### ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®æ¦‚è¦

ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœ (Fresnel effect) ã¯ã€å…‰ã®åå°„ã¨å±ˆæŠ˜ãŒè¦–ç·šã®è§’åº¦ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ç¾è±¡ã®ã“ã¨

ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®ç‰¹å¾´

- è¡¨é¢ã«å¯¾ã—ã¦å‚ç›´ã«è¿‘ã„è§’åº¦ã‹ã‚‰è¦‹ã‚‹ã¨ç‰©ä½“ã¯æ¯”è¼ƒçš„é€æ˜ã«è¦‹ãˆã‚‹
- è¡¨é¢ã«å¯¾ã—ã¦æµ…ã„è§’åº¦ã‹ã‚‰è¦‹ã‚‹ã¨ç‰©ä½“ã¯ã‚ˆã‚Šåå°„ã—ã¦è¦‹ãˆã‚‹

ä¾‹: æ°´ã®è¡¨é¢
çœŸä¸Š(æ°´é¢ã«å¯¾ã—ã¦å‚ç›´ã«è¿‘ã„è§’åº¦)ã‹ã‚‰è¦‹ã‚‹ã¨æ°´ä¸­ãŒè¦‹ãˆã‚‹ãŒã€æµ…ã„è§’åº¦(æ°´é¢ã«å¯¾ã—ã¦æ°´å¹³ã«è¿‘ã„è§’åº¦)ã‹ã‚‰è¦‹ã‚‹ã¨æ°´ã«åå°„ã—ã¦è¦‹ãˆã‚‹

#### 3D ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«ãŠã‘ã‚‹ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®é‡è¦æ€§

- ãƒªã‚¢ãƒ«ãªè¡¨ç¾ : ç‰©ä½“ã‚’ã‚ˆã‚Šè‡ªç„¶ã«è¦‹ã›ã‚‹
- å¥¥è¡Œãã‚’å¼·èª¿ : ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å½¢çŠ¶ã‚„ä½ç½®é–¢ä¿‚ã‚’ã‚ˆã‚Šå¼·èª¿ã™ã‚‹
- ãƒãƒ†ãƒªã‚¢ãƒ«è¡¨ç¾ã®è±Šã‹ã• : é‡‘å±ã‚„ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã€ã‚¬ãƒ©ã‚¹ãªã©å¤šå½©ãªæè³ªã‚’è¡¨ç¾ã§ãã‚‹

Three.js ã®å ´åˆ **PBR** ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
`MeshStandardMaterial`ã‚„`MeshPhysicalMaterial`ã«ã¯ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã‚’ä½¿ç”¨ã—ã¦è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹

### ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—

ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—ã‚’è¡Œã†ãŸã‚ã«é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ **Normal(æ³•ç·š)** ã‚’`variyng` ã§ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡ã—ã¾ã™

```glsl
// vertex.glsl ã«è¨˜è¿°

varying vec3 vPosition;
varying vec3 vNormal;

void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;

  // varying
  vPosition = modelPosition.xyz;
  vNormal = normal;
}
```

```glsl
// fragment.glsl ã«è¨˜è¿°

uniform float uTime;
uniform float uAnimationSpeed;

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // ...

  gl_FragColor = vec4(vec3(1.0), stripes);
  gl_FragColor = vec4(vec3(vNormal), 1.0); // æ³•ç·šã‚’å–å¾—ã§ãã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆ

  // Three.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}

```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/9df39a3b2b450dbf66290a2b900accce.png)](https://gyazo.com/9df39a3b2b450dbf66290a2b900accce)

#### è¦–ç·šæ–¹å‘ã®è¨ˆç®—

ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—ã«ã¯**è¦–ç·šæ–¹å‘**ã¨**ãƒ‰ãƒƒãƒˆç©**ã‚’ä½¿ç”¨ã—ã¾ã™
ã¾ãšã¯è¦–ç·šæ–¹å‘ã‚’è¨ˆç®—ã—ã¾ã™

`viewDirection(è¦–ç·šæ–¹å‘)`ã¯
`vPosition(ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã® 3D ä¸Šã®ä½ç½®)` ã‹ã‚‰ `cameraPosition(ã‚«ãƒ¡ãƒ©ã®ä½ç½®)`ã‚’æ¸›ç®—ã—ã¦æ±‚ã‚ã¾ã™

```glsl
// fragment.glsl ã«è¨˜è¿°

// ...

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // ...

  vec3 viewDirection = vPosition - cameraPosition;

  // ...
}
```

#### ãƒ‰ãƒƒãƒˆç©ã®è¨ˆç®—

ãƒ‰ãƒƒãƒˆç©ã¯
`dot é–¢æ•°` ã¨ã„ã†ç‰¹æ®Šãªé–¢æ•°ã§ 2 ã¤ã®ãƒ™ã‚¯ãƒˆãƒ«ã®å†…ç©ã‚’æ±‚ã‚ã¾ã™ãŒ
ã“ã®é–¢æ•°ã¯ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ãŒåŒã˜ã˜ã‚ƒãªã„ã¨ã„ã‘ã¾ã›ã‚“

`vNoraml(æ³•ç·š)`ã®ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ã¯ `1` ãªã®ã§

`viewDirection(è¦–ç·šæ–¹å‘)` ã®ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ã‚’ `1` ã«ã™ã‚‹ãŸã‚ã« `noramize é–¢æ•°`ã‚’ä½¿ç”¨ã—ã¦å€¤ã‚’æ­£è¦åŒ–ã—ã¾ã™ã€‚

> [!NOTE]
>
> ğŸ“ **Memo**
>
> ãªãœæ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ã¯ 1 ãªã®ã‹ï¼Ÿ
>
> glsl ã§æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã¯ä¸»ã«è¨ˆç®—ã®ç°¡ç•¥åŒ–ã®ãŸã‚ã«å˜ä½ãƒ™ã‚¯ãƒˆãƒ«(é•·ã•ãŒ 1 ã®ãƒ™ã‚¯ãƒˆãƒ«)ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚

```glsl
// fragment.glsl ã«è¨˜è¿°

// ...

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // ...

  vec3 viewDirection = normalize(vPosition - cameraPosition); // å€¤ã‚’ 1 ã«æ­£è¦åŒ–

  // ...
```

ã“ã‚Œã§ `dot é–¢æ•°`ãŒä½¿ç”¨ã§ãã¾ã™ã€‚

```glsl
// fragment.glsl ã«è¨˜è¿°

// ...

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // ...

  vec3 viewDirection = normalize(vPosition - cameraPosition);
  float fresnel = dot(viewDirection, vNormal);

  // ...
```

**å‡ºåŠ›çµæœ**

ã‚ã¡ã‚ƒãã¡ã‚ƒã‚ã‹ã‚Šã«ãã§ã™ãŒã†ã£ã™ã‚‰è¼ªéƒ­ãŒè¦‹ãˆã¾ã™

[![Image from Gyazo](https://i.gyazo.com/b2193e5f928b36fe98bc63f3cdda8899.png)](https://gyazo.com/b2193e5f928b36fe98bc63f3cdda8899)

### ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®å•é¡Œç‚¹ã¨ä¿®æ­£

ã“ã®ã¾ã¾ã ã¨ 2 ã¤ã®å•é¡ŒãŒã‚ã‚Šã¾ã™

1. ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—å€¤ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›è»¢ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¦ã—ã¾ã†
2. è¡¨é¢ã«è¦å‰‡çš„ãªæ¨¡æ§˜ãŒè¦‹ãˆã‚‹

ã“ã‚Œã‚‰ã‚’ä¿®æ­£ã—ã¦ãã¾ã™

#### å•é¡Œã®ä¿®æ­£: ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—å€¤ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›è»¢ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¦ã—ã¾ã†

ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®è¨ˆç®—å€¤ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›è»¢ã§å¤‰åŒ–ã—ãªã„ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

ã¾ãšã¯æ³•ç·šã®å‘ãã‚’ä¿®æ­£ã—ã¾ã™ã€‚
æ³•ç·šã®å‘ãã‚’ä¿®æ­£ã™ã‚‹ã«ã¯é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§ãƒ¢ãƒ‡ãƒ«ã®æ³•ç·šã‚’è¨ˆç®—ã—ã¾ã™

```glsl
// vertex.glsl ã«è¨˜è¿°

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // ...

    // ãƒ¢ãƒ‡ãƒ«ã®æ³•ç·š
  vec4 modelNormal = modelMatrix * vec4(normal, 0.0); // 0.0 ã«ã™ã‚‹ã“ã¨ã§ãƒ¢ãƒ‡ãƒ«ãŒå¤‰æ›(ç§»å‹•ã€å›è»¢ã€ã‚¹ã‚±ãƒ¼ãƒ«)ã—ã¦ã‚‚ãã‚Œã‚‰ãŒé©ç”¨ã•ã‚Œãªã„

  // varying
  vPosition = modelPosition.xyz;
  vNormal = modelNormal.xyz;
}
```

> [!NOTE]
>
> ğŸ“ **Memo**
>
> ãªãœ normal ã®ã¨ãã¯ vec4 ã®ç¬¬ 4 å¼•æ•° ãŒ 0.0 ï¼Ÿ
>
> `1.0` ã«è¨­å®šã™ã‚‹å ´åˆã€ãƒ™ã‚¯ãƒˆãƒ«ã¯åŒæ¬¡ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
> ã“ã‚Œã«ã‚ˆã‚Šå¤‰æ›(ç§»å‹•ã€å›è»¢ã€æ‹¡å¤§ç¸®å°)ã‚‚åŒæ§˜ã«é©ç”¨ã•ã‚Œã‚‹
>
> `0.0` ã«è¨­å®šã™ã‚‹å ´åˆã€ãƒ™ã‚¯ãƒˆãƒ«ã¯åŒæ¬¡ã§ã¯ç„¡ã„ã“ã¨ã‚’ç¤ºã™
> ãªã®ã§å¤‰æ›ã¯é©ç”¨ã•ã‚Œãªã„ã€‚
> æ³•ç·šã«ã¯é©ç”¨ã•ã›ãŸããªã„ã®ã§ `0.0` ã« è¨­å®šã™ã‚‹

```glsl
// faragment.glsl ã«è¨˜è¿°
// ...

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  vec3 viewDirection = normalize(vPosition - cameraPosition);
  float fresnel = dot(viewDirection, vNormal) + 1.0;
  // + 1.0 ã¯ å€¤ã‚’ 0 ã‹ã‚‰ 1 ã®ç¯„å›²ã«ã™ã‚‹ãŸã‚ã€ã“ã‚Œã‚’ã—ãªã„ã¨ãªã«ã‚‚è¡¨ç¤ºã•ã‚Œãªããªã‚‹

  fresnel = pow(fresnel, 2.0);
  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ã®æ™‚ã¨åŒæ§˜ã€ã‚ˆã‚Šã‚·ãƒ£ãƒ¼ãƒ—ã«ã™ã‚‹ãŸã‚

  gl_FragColor = vec4(vec3(1.0), fresnel);

  // ...
}
```

å‡ºåŠ›çµæœ

[![Image from Gyazo](https://i.gyazo.com/f7f3b9af20f081d19a5df0824cc0cddd.png)](https://gyazo.com/f7f3b9af20f081d19a5df0824cc0cddd)

#### å•é¡Œã®ä¿®æ­£: è¡¨é¢ã«è¦å‰‡çš„ãªæ¨¡æ§˜ãŒè¦‹ãˆã‚‹

[![Image from Gyazo](https://i.gyazo.com/c3a961e393a2d50137f5255d10b57b6f.png)](https://gyazo.com/c3a961e393a2d50137f5255d10b57b6f)

ç”»åƒã§ã¯ã†ã¾ãè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ãŒã€ã‚ˆãè¦‹ã‚‹ã¨
è¦å‰‡çš„ãªæ¨¡æ§˜ãŒè¦‹ãˆã¾ã™ã€‚

ã“ã‚Œã¯ é ‚ç‚¹é–“ã§ã¯å¤‰åŒ–ã—ãŸå€¤ãŒè£œé–“ã•ã‚Œã‚‹ãŸã‚ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ãŒå¸¸ã« `1` ã§ã¯ãªããªã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

ã“ã‚Œã¯ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã§å†åº¦æ­£è¦åŒ–ã™ã‚‹ã“ã¨ã§ä¿®æ­£å‡ºæ¥ã¾ã™

```glsl
// farment.glsl ã«è¨˜è¿°

uniform float uTime;
uniform float uAnimationSpeed;

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  vec3 normal = normalize(vNormal); // æ³•ç·šã®æ­£è¦åŒ–

  // ...

  vec3 viewDirection = normalize(vPosition - cameraPosition);
  float fresnel = dot(viewDirection, normal) + 1.0;

  fresnel = pow(fresnel, 2.0);

  gl_FragColor = vec4(vec3(1.0), fresnel);

  // ...
}
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/eb44afa5a95328dd313b5d150a862cb8.png)](https://gyazo.com/eb44afa5a95328dd313b5d150a862cb8)

## ãƒ›ãƒ­ã‚°ãƒ©ãƒ åŠ¹æœã®å®Œæˆ

### ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã®çµ„ã¿åˆã‚ã›

```glsl
// farment.glsl ã«è¨˜è¿°

// ...

void main() {
    // æ³•ç·š
  vec3 normal = normalize(vNormal);

  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—
  float stripes = mod((vPosition.y - uTime * uAnimationSpeed) * 20.0, 1.0);
  stripes = pow(stripes, 3.0);

  // ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœ
  vec3 viewDirection = normalize(vPosition - cameraPosition);
  float fresnel = dot(viewDirection, normal) + 1.0;
  fresnel = pow(fresnel, 2.0);

  // ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯
  float holographic = stripes * fresnel;
  holographic += fresnel * 1.10; // æš—ãã¦è¦‹ãˆã«ãã„ã®ã§å¼·åº¦ã‚’èª¿æ•´

  gl_FragColor = vec4(vec3(1.0), holographic);

  // Three.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/7e3e4ea8e0b2eb0e08a563896ca3a2c7.png)](https://gyazo.com/7e3e4ea8e0b2eb0e08a563896ca3a2c7)

### èƒŒé¢ã®è¡¨ç¤ºã¨ä¿®æ­£

èƒŒé¢ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ãƒãƒ†ãƒªã‚¢ãƒ«ã®`side`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«`side: THREE.DoubleSide`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```js
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
  },
  transparent: true,
  side: THREE.DoubleSide, // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸¡å´ã‚’è¡¨ç¤ºã™ã‚‹
});
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/59f324876ec85318dc325d4e48ef089c.png)](https://gyazo.com/59f324876ec85318dc325d4e48ef089c)

ã“ã®ã¾ã¾ã ã¨ã€èƒŒé¢ãŒå¼·èª¿ã•ã‚Œã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã‚’é©ç”¨ã—ãŸã¨ãç¯„å›²ã‚’èª¿æ•´ã™ã‚‹ãŸã‚ã« `+ 1.0` ã‚’åŠ ç®—ã—ã¾ã—ãŸ
èƒŒé¢ã‚‚è¡¨ç¤ºã™ã‚‹å ´åˆã¯ã€ã“ã‚ŒãŒæ‚ªã•ã‚’ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã¡ã‚‰ã‚’ä¿®æ­£ã™ã‚‹ã«ã¯ã¾ãšã€èƒŒé¢ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
GLSL ã«ã¯ æç”»ã—ã¦ã„ã‚‹ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆãŒã‚«ãƒ¡ãƒ©ã«å‘ã„ã¦ã„ã‚‹ã‹ã‚’ç¤ºã™
`gl_FrontFacing`ã¨ã„ã†åå‰ã®å¤‰æ•°ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®å¤‰æ•°ã‚’åˆ©ç”¨ã—ã¦ã‚«ãƒ¡ãƒ©ã«å‘ã„ã¦ã„ãªã„ã¨ãå€¤ã« `-1.0` ã‚’ä¹—ç®—ã—ã¦ã€åè»¢ã•ã›ã¾ã™

> [!NOTE]
>
> ğŸ“ **Memo**
>
> `gl_ForantFacing`ã¯ãƒ–ãƒ¼ãƒ«å€¤ (true, false)

```glsl
// fragment.glsl ã«è¨˜è¿°
// ...

void main() {

  // æ³•ç·š
  vec3 normal = normalize(vNormal);

  if(!gl_FrontFacing) {
    normal *= -1.0;
  }

  // ...
}
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/95fca759ce3784f824db6b01c81c02d0.png)](https://gyazo.com/95fca759ce3784f824db6b01c81c02d0)

### æ·±åº¦ãƒãƒƒãƒ•ã‚¡ã®èª¿æ•´

è‰¯ããªã‚Šã¾ã—ãŸãŒæ·±åº¦ãƒãƒƒãƒ•ã‚¡ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å‰é¢ãŒèƒŒé¢ã‚’éš ã—ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚’ä¿®æ­£ã™ã‚‹ã«ã¯ãƒãƒ†ãƒªã‚¢ãƒ«ã®`depthWrite`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`false`ã«è¨­å®šã—ã¾ã™

```js
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
  },
  transparent: true,
  side: THREE.DoubleSide,
  depthWrite: false, // æ·±åº¦ãƒãƒƒãƒ•ã‚¡ã‚’ç„¡åŠ¹åŒ–
});
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/16ba40fd6d69fe48255cdc8c48172aa7.png)](https://gyazo.com/16ba40fd6d69fe48255cdc8c48172aa7)

### ãƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®è¨­å®š

ã•ã‚‰ã«ã€ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã¯å…‰ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’é‘‘ã¿ã¦
ãƒãƒ†ãƒªã‚¢ãƒ«ã®`blending`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`THREE.AdditiveBlending`ã«è¨­å®šã™ã‚‹ã“ã¨ã§
ã‚ˆã‚Šã‚ˆã‚Šè¦‹ãŸç›®ã«ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

> [!NOTE]
>
> ğŸ“ **Memo**
>
> `THREE.AdditiveBlending` ã¯ æ–°ã—ãæç”»ã•ã‚Œã‚‹ãƒ”ã‚¯ã‚»ãƒ«ã®è‰²å€¤ã‚’æ—¢å­˜ã®ãƒ”ã‚¯ã‚»ãƒ«ã®è‰²å€¤ã«åŠ ç®—ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šé‡ãªã‚Šåˆã†éƒ¨åˆ†ãŒæ˜ã‚‹ããªã‚Šã€å…‰ãŒé‡ãªã‚Šé–‹ãã‚ˆã†ãªåŠ¹æœã‚’å¾—ã‚‰ã‚Œã‚‹

```js
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
  },
  transparent: true,
  side: THREE.DoubleSide,
  depthWrite: false,
  blending: THREE.AdditiveBlending,
});
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/94acba668e41b6a24bc94a0023f3094e.png)](https://gyazo.com/94acba668e41b6a24bc94a0023f3094e)

### ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•(æ¸›è¡°åŠ¹æœ)

ã‚¨ãƒƒã‚¸ã®ã‚¢ãƒ«ãƒ•ã‚¡å€¤ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚
ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœã«ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ãƒ†ãƒƒãƒ—ã‚’é©ç”¨ã—å€¤ã‚’å†ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•(æ¸›è¡°åŠ¹æœ)ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

```glsl
// faragment.glsl ã«è¨˜è¿°

// ...

void main() {

  // ...

  // ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•
  float falloff = smoothstep(0.8, 0.0, fresnel);

  // ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯
  float holographic = stripes * fresnel;
  holographic += fresnel * 1.10;
  holographic *= falloff;

  gl_FragColor = vec4(vec3(1.0), holographic);

  // ...
}
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/d50cd24b5aa92d635739d03778cb0da3.png)](https://gyazo.com/d50cd24b5aa92d635739d03778cb0da3)

### ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ

<details>
<summary>. jsãƒ•ã‚¡ã‚¤ãƒ«(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```js
import GUI from "lil-gui";
import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import fragmentShader from "./shaders/holographic/fragment.glsl";
import vertexShader from "./shaders/holographic/vertex.glsl";

// ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
const gui = new GUI();
const canvas = document.querySelector("canvas.webgl");
const scene = new THREE.Scene();
const gltfLoader = new GLTFLoader();
const sizes = {
  width: window.innerWidth,
  height: window.innerHeight,
};

window.addEventListener("resize", () => {
  sizes.width = window.innerWidth;
  sizes.height = window.innerHeight;

  camera.aspect = sizes.width / sizes.height;
  camera.updateProjectionMatrix();

  renderer.setSize(sizes.width, sizes.height);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
});

// ã‚«ãƒ¡ãƒ©
const camera = new THREE.PerspectiveCamera(
  25,
  sizes.width / sizes.height,
  0.1,
  100
);
camera.position.set(7, 7, 7);
scene.add(camera);

// ã‚ªãƒ¼ãƒ“ãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
const controls = new OrbitControls(camera, canvas);
controls.enableDamping = true;

// ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
const rendererParameters = {};
rendererParameters.clearColor = "#1d1f2a";

const renderer = new THREE.WebGLRenderer({
  canvas: canvas,
  antialias: true,
});
renderer.setClearColor(rendererParameters.clearColor);
renderer.setSize(sizes.width, sizes.height);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

gui.addColor(rendererParameters, "clearColor").onChange(() => {
  renderer.setClearColor(rendererParameters.clearColor);
});

// ãƒãƒ†ãƒªã‚¢ãƒ«
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
  },
  transparent: true,
  side: THREE.DoubleSide,
  depthWrite: false,
  blending: THREE.AdditiveBlending,
});

// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
// Torus knot
const torusKnot = new THREE.Mesh(
  new THREE.TorusKnotGeometry(0.6, 0.25, 128, 32),
  material
);
torusKnot.position.x = 3;
scene.add(torusKnot);

// Sphere
const sphere = new THREE.Mesh(new THREE.SphereGeometry(), material);
sphere.position.x = -3;
scene.add(sphere);

// Suzanne
let suzanne = null;
gltfLoader.load("./suzanne.glb", (gltf) => {
  suzanne = gltf.scene;
  suzanne.traverse((child) => {
    if (child.isMesh) child.material = material;
  });
  scene.add(suzanne);
});

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const clock = new THREE.Clock();

const tick = () => {
  const elapsedTime = clock.getElapsedTime();
  material.uniforms.uTime.value = elapsedTime;

  if (suzanne) {
    suzanne.rotation.x = -elapsedTime * 0.1;
    suzanne.rotation.y = elapsedTime * 0.2;
  }

  sphere.rotation.x = -elapsedTime * 0.1;
  sphere.rotation.y = elapsedTime * 0.2;

  torusKnot.rotation.x = -elapsedTime * 0.1;
  torusKnot.rotation.y = elapsedTime * 0.2;

  controls.update();

  renderer.render(scene, camera);

  window.requestAnimationFrame(tick);
};

tick();
```

</details>

<details>
<summary>. glslãƒ•ã‚¡ã‚¤ãƒ«(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```glsl
// vertex.glsl

varying vec3 vPosition;
varying vec3 vNormal;

void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;

    // ãƒ¢ãƒ‡ãƒ«ã®æ³•ç·š
  vec4 modelNormal = modelMatrix * vec4(normal, 0.0);

  // varying
  vPosition = modelPosition.xyz;
  vNormal = modelNormal.xyz;
}
```

```glsl
// fragent.glsl
uniform float uTime;
uniform float uAnimationSpeed;

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // æ³•ç·š
  vec3 normal = normalize(vNormal);
  if(!gl_FrontFacing) {
    normal *= -1.0;
  }
  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—
  float stripes = mod((vPosition.y - uTime * uAnimationSpeed) * 20.0, 1.0);
  stripes = pow(stripes, 3.0);

  // ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœ
  vec3 viewDirection = normalize(vPosition - cameraPosition);
  float fresnel = dot(viewDirection, normal) + 1.0;
  fresnel = pow(fresnel, 2.0);

  // ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•
  float falloff = smoothstep(0.8, 0.0, fresnel);

  // ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯
  float holographic = stripes * fresnel;
  holographic += fresnel * 1.10;
  holographic *= falloff;

  gl_FragColor = vec4(vec3(1.0), holographic);

  // Three.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}

```

</details>

## è‰²ã®å¤‰æ›´

ãƒ‡ãƒãƒƒã‚° UI ã§è‰²ã®å¤‰æ›´ã‚’è¡Œã„ã¾ã™

è‰²ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã«ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«é€ä¿¡ã—ã¾ã™
ãƒãƒ†ãƒªã‚¢ãƒ«ã®`uniforms`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«`uColor`ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¿½åŠ ã—
`new THREE.Uniform(new THREE.Color(('red'))`ã§è¿½åŠ ã—ã¾ã™

```js
// ãƒãƒ†ãƒªã‚¢ãƒ«
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
    uColor: new THREE.Uniform(new THREE.Color("red")),
  },
  transparent: true,
  side: THREE.DoubleSide,
  depthWrite: false,
  blending: THREE.AdditiveBlending,
});
```

```glsl
// fargment.glsl ã«è¨˜è¿°

// ...

uniform vec3  uColor; // è‰²ã¯ vec3 ã§æ‰±ã†

// ...

void main() {

// ...

  gl_FragColor = vec4(vec3(uColor), holographic);

  // ...
}
```

**å‡ºåŠ›çµæœ**

[![Image from Gyazo](https://i.gyazo.com/e22e46c343a3788ae82e9843a1f3a411.png)](https://gyazo.com/e22e46c343a3788ae82e9843a1f3a411)

### ãƒ‡ãƒãƒƒã‚° UI ã®è¿½åŠ 

ãƒ€ãƒŸãƒ¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™

```js
const debugUIConfig = {
  color: "#70c1ff",
};
```

lilgui ã§ ãƒ‡ãƒãƒƒã‚° UI ã‚’è¿½åŠ ã—ã¾ã™
ä»Šå›ã¯è‰²ã®å¤‰æ›´ãªã®ã§`gui.addColor`ã‚’ä½¿ç”¨ã—ã¾ã™

`onChange`ã§å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦ãƒ‡ãƒãƒƒã‚° UI ã§ã®è‰²ã‚’å†è¨­å®šã—ã¾ã™

```js
gui.addColor(debugUIConfig, "color").onChange(() => {
  material.uniforms.uColor.value.set(debugUIConfig.color);
});
```

`uColor`ã‚‚ãƒ€ãƒŸãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã«è¨­å®šã—ã¾ã™

```js
// ãƒãƒ†ãƒªã‚¢ãƒ«
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
    uColor: new THREE.Uniform(new THREE.Color(debugUIConfig.color)),
  },
  transparent: true,
  side: THREE.DoubleSide,
  depthWrite: false,
  blending: THREE.AdditiveBlending,
});
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/dd1fdee7b854ae0a34336ead9d3552da"><img src="https://i.gyazo.com/dd1fdee7b854ae0a34336ead9d3552da.gif" alt="Image from Gyazo" width="1000"/></a>

## ã‚°ãƒªãƒƒãƒåŠ¹æœã®å®Ÿè£…

### ãƒ©ãƒ³ãƒ€ãƒ é–¢æ•°ã®ä½œæˆ

ã¾ãšã¯ã€x è»¸ã¨ z è»¸ã®é ‚ç‚¹ãŒãƒ©ãƒ³ãƒ€ãƒ ã§ç§»å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™
ã§ã™ãŒ GLSL ã«ã¯ãƒ©ãƒ³ãƒ€ãƒ é–¢æ•°ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“

[Book of Shaders ã®è¨˜äº‹](https://thebookofshaders.com/10/)ã‚’å‚è€ƒã«æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

```glsl

float random2D(vec2 value) {
  return fract(sin(dot(value.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

// vec2 ã‚’å—ã‘å–ã£ã¦ float ã® 0,0 ã‹ã‚‰ 1,0 ã¾ã§ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤ã‚’è¿”ã™

```

### ã™ã¹ã¦ã®é ‚ç‚¹ã«ã‚°ãƒªãƒƒãƒåŠ¹æœã‚’é©ç”¨

`random2Dé–¢æ•°`ã‚’ä½¿ç”¨ã—ã¦ `modelPosition` ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```glsl
varying vec3 vPosition;
varying vec3 vNormal;

float random2D(vec2 value) {
  return fract(sin(dot(value.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);

  // ã‚°ãƒªãƒƒãƒåŠ¹æœ
  modelPosition.x += random2D(modelPosition.xz);
  modelPosition.z += random2D(modelPosition.zx);

  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;

    // ãƒ¢ãƒ‡ãƒ«ã®æ³•ç·š
  vec4 modelNormal = modelMatrix * vec4(normal, 0.0);

  // varying
  vPosition = modelPosition.xyz;
  vNormal = modelNormal.xyz;
}
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/dd3f415e30060f285ba4adc44da7c7cf"><img src="https://i.gyazo.com/dd3f415e30060f285ba4adc44da7c7cf.gif" alt="Image from Gyazo" width="1000"/></a>

> [!NOTE]
>
> ğŸ“ **Memo**
>
> ãªãœ x è»¸ã«ã¯ `modelPosition.xz` ã§ z è»¸ã«ã¯ `modelPosition.zx`ãªã®ï¼Ÿ
>
> ã“ã‚Œã¯ã€x è»¸ã¨ z è»¸ã§ç•°ãªã‚‹ãƒ©ãƒ³ãƒ€ãƒ å€¤ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã€‚
>
> - `modelPosition.xz` ã¯ (x, z) åº§æ¨™ã‚’è¡¨ã™
> - `modelPosition.zx` ã¯ (z, x) åº§æ¨™ã‚’è¡¨ã™
>
> GLSL ã®ã‚¹ã‚¦ã‚£ã‚ºãƒªãƒ³ã‚°ã‚’å¿œç”¨ã—åŒã˜å…¥åŠ›å€¤ã‹ã‚‰ç•°ãªã‚‹å€¤ã‚’å‡ºåŠ›ã§ãã‚‹
> x è»¸ã¨ z è»¸ãŒåŒã˜å€¤ã«ãªã‚‰ãªã„ã®ã§ã€ã‚ˆã‚Šè‡ªç„¶ãªãƒ©ãƒ³ãƒ€ãƒ ãªç§»å‹•ã«ãªã‚‹

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¿®æ­£

tick é–¢æ•°ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ãƒ¢ãƒ‡ãƒ«ã®å‹•ãã‚’æ­¢ã‚ã‚‹ã¨
ã‚°ãƒªãƒƒãƒåŠ¹æœã‚‚åœæ­¢ã—ã¦è¦‹ãˆã¾ã™

```js
// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const clock = new THREE.Clock();

const tick = () => {
  const elapsedTime = clock.getElapsedTime();
  material.uniforms.uTime.value = elapsedTime;

  // if (suzanne) {
  //   suzanne.rotation.x = -elapsedTime * 0.1;
  //   suzanne.rotation.y = elapsedTime * 0.2;
  // }

  // sphere.rotation.x = -elapsedTime * 0.1;
  // sphere.rotation.y = elapsedTime * 0.2;

  // torusKnot.rotation.x = -elapsedTime * 0.1;
  // torusKnot.rotation.y = elapsedTime * 0.2;

  controls.update();

  renderer.render(scene, camera);

  window.requestAnimationFrame(tick);
};
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/970f29a0178cce4f86c134312b7bb171"><img src="https://i.gyazo.com/970f29a0178cce4f86c134312b7bb171.gif" alt="Image from Gyazo" width="1000"/></a>

ã“ã‚Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã«
`uTime` ã‚’ä½¿ç”¨ã—ã¾ã™

```glsl
// vertex.glsl ã«è¨˜è¿°

uniform float uTime;

varying vec3 vPosition;
varying vec3 vNormal;

float random2D(vec2 value) {
  return fract(sin(dot(value.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);

  // ã‚°ãƒªãƒƒãƒåŠ¹æœ
  modelPosition.x += random2D(modelPosition.xz + uTime) - 0.5;
  modelPosition.z += random2D(modelPosition.zx + uTime) - 0.5;

  // å€¤ã‚’ - 0.5 ã—ã¦ã„ã‚‹ã®ã¯ ç¯„å›²ã‚’ - 0.5 ã‹ã‚‰ 0.5 ã«ã—ã¦ä¸¡æ–¹å‘ã«å‹•ãã‚ˆã†ã«ã™ã‚‹ãŸã‚

  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;

    // ãƒ¢ãƒ‡ãƒ«ã®æ³•ç·š
  vec4 modelNormal = modelMatrix * vec4(normal, 0.0);

  // varying
  vPosition = modelPosition.xyz;
  vNormal = modelNormal.xyz;
}
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/0c54d98832cb41bb3bbf13ae1fde8c23"><img src="https://i.gyazo.com/0c54d98832cb41bb3bbf13ae1fde8c23.gif" alt="Image from Gyazo" width="1000"/></a>

### ä¸‹ã‹ã‚‰ä¸Šã¸ã¨æ³¢ã®ã‚ˆã†ã«å¤‰åŒ–ã•ã›ã‚‹

ã‚°ãƒªãƒƒãƒåŠ¹æœãŒä¸‹ã‹ã‚‰ä¸Šã¸ã¨æ³¢ã®ã‚ˆã†ã«å¤‰åŒ–ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ã«ã¯

å¤‰æ•° `glitchStrength` ä½œæˆã— `sin é–¢æ•°`ã§ `uTime` ã‚’ -1.0 ã‹ã‚‰ 1.0 ã®å€¤ã«å¤‰æ›ã—ã¾ã™
`modelPosition`ã«ä¹—ç®—ã—ã¾ã™ã€‚

ä¸‹ã‹ã‚‰ä¸Šã¸ã¨å¤‰åŒ–ã•ã›ã‚‹ãŸã‚ã«
`modelPosition.y` ã‚’æ¸›ç®—ã—ã¾ã™

```glsl
// vertex.glsl ã«è¨˜è¿°

uniform float uTime;

// ...

void main() {
  // ...

  // ã‚°ãƒªãƒƒãƒåŠ¹æœ
  float glitchStrength = sin(uTime - modelPosition.y); // ä¸‹ã‹ã‚‰ä¸Šã¸ã¨å¤‰åŒ–
  glitchStrength *= 0.25; // åŠ¹æœã‚’å¼±ã‚ã‚‹

  modelPosition.x += (random2D(modelPosition.xz + uTime) - 0.5) * glitchStrength;
  modelPosition.z += (random2D(modelPosition.zx + uTime) - 0.5) * glitchStrength;

  // ...

}
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/5b55c7ee737eaa0e213e45f56034945b"><img src="https://i.gyazo.com/5b55c7ee737eaa0e213e45f56034945b.gif" alt="Image from Gyazo" width="1000"/></a>

### ã‚°ãƒªãƒƒãƒåŠ¹æœã®é »åº¦ã‚’èª¿æ•´

sin é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ å€¤ã¯ -1 ã‹ã‚‰ 1 ã«å¤‰åŒ–ã—ã¾ã™ã€‚
ãã®ãŸã‚ã»ã¨ã‚“ã©ã®å ´åˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹ã¨ãªã‚‹ãŸã‚å¸¸ã«ã‚°ãƒªãƒƒãƒåŠ¹æœãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã®çŠ¶æ…‹ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã« `smoothstep é–¢æ•°` ã§å€¤ã‚’å†ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã‚°ãƒªãƒƒãƒåŠ¹æœã®è¡¨ç¤ºé »åº¦ã‚’èª¿æ•´ã—ã¾ã™ã€‚

```glsl
// vertex.glsl ã«è¨˜è¿°

uniform float uTime;

// ...

void main() {
  // ...

  // ã‚°ãƒªãƒƒãƒåŠ¹æœ
  float glitchStrength = sin(uTime - modelPosition.y);

   // å€¤ã‚’å†ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºé »åº¦ã‚’èª¿æ•´
  glitchStrength = smoothstep(
    0.3, // å€¤ãŒ 1,0 ã«è¿‘ã„ã»ã©è¡¨ç¤ºé »åº¦ãŒå°‘ãªããªã‚‹
    1.0, // å€¤ãŒ 0.0 ã«è¿‘ã„ã»ã©ã‚°ãƒªãƒƒãƒåŠ¹æœãŒæ€¥æ¿€ã«å¤‰åŒ–ã™ã‚‹
    glitchStrength);

  glitchStrength *= 0.25;

  modelPosition.x += (random2D(modelPosition.xz + uTime) - 0.5) * glitchStrength;
  modelPosition.z += (random2D(modelPosition.zx + uTime) - 0.5) * glitchStrength;

  // ...

}
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/ce186234e5c9a8233f18572a0fa62d07"><img src="https://i.gyazo.com/ce186234e5c9a8233f18572a0fa62d07.gif" alt="Image from Gyazo" width="1000"/></a>

### ç•°ãªã‚‹å‘¨æ³¢æ•°ã‚’åˆ©ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’è¿½åŠ 

ã¾ãšã¯ç¹°ã‚Šè¿”ã—æ•°å¼ã‚’è¨˜è¿°ã—ãªã„ãŸã‚ã« å¤‰æ•° `glotchTime`ã‚’ä½œæˆ

å‘¨æ³¢æ•°ã®ç•°ãªã‚‹ sin é–¢æ•°ã‚’ 3 ã¤ç”¨æ„ã—ãã‚Œãã‚Œã‚’åŠ ç®—ã—ã¾ã™
ãã—ã¦ sin é–¢æ•°ã®æ•°ã§å‰²ã‚Šæˆ»ã—ã¾ã™

```glsl
// vertex.glsl ã«è¨˜è¿°

// ...

void main() {

  // ...

  // ã‚°ãƒªãƒƒãƒåŠ¹æœ
  float glotchTime = uTime - modelPosition.y;
  float glitchStrength = sin(glotchTime) + sin(glotchTime * 2.354) + sin(glotchTime * 9.6436);
  glitchStrength /= 3.0;
  glitchStrength = smoothstep(0.3, 1.0, glitchStrength);
  glitchStrength *= 0.25;

  modelPosition.x += (random2D(modelPosition.xz + uTime) - 0.5) * glitchStrength;
  modelPosition.z += (random2D(modelPosition.zx + uTime) - 0.5) * glitchStrength;

  // ...
}
```

**å‡ºåŠ›çµæœ**

<a href="https://gyazo.com/9c1a18ad4b83ae624575c618875f76f0"><img src="https://i.gyazo.com/9c1a18ad4b83ae624575c618875f76f0.gif" alt="Image from Gyazo" width="1000"/></a>

## ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ³ã‚¯ã®åˆ†é›¢

`random2D é–¢æ•°`ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ã¾ã™
shaders ãƒ•ã‚©ãƒ«ãƒ€å†…ã« includes ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦
`random2D.glsl`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™

```glsl
// random2D.glsl ã«è¨˜è¿°

float random2D(vec2 value) {
  return fract(sin(dot(value.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}
```

`random2D é–¢æ•°`ã®ä»£ã‚ã‚Šã« `#include` ã‚’ä½¿ç”¨ã—ã¾ã™

```glsl
// vertex.glsl ã«è¨˜è¿°

// ...

#include ../includes/random2D.glsl

void main() {
  // ...

  modelPosition.x += (random2D(modelPosition.xz + uTime) - 0.5) * glitchStrength;
  modelPosition.z += (random2D(modelPosition.zx + uTime) - 0.5) * glitchStrength;

  // ...
}
```

### æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ

<details>
<summary>. jsãƒ•ã‚¡ã‚¤ãƒ«(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```js
import GUI from "lil-gui";
import * as THREE from "three";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import fragmentShader from "./shaders/holographic/fragment.glsl";
import vertexShader from "./shaders/holographic/vertex.glsl";

// ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
const gui = new GUI();
const canvas = document.querySelector("canvas.webgl");
const scene = new THREE.Scene();
const gltfLoader = new GLTFLoader();
const sizes = {
  width: window.innerWidth,
  height: window.innerHeight,
};

window.addEventListener("resize", () => {
  sizes.width = window.innerWidth;
  sizes.height = window.innerHeight;

  camera.aspect = sizes.width / sizes.height;
  camera.updateProjectionMatrix();

  renderer.setSize(sizes.width, sizes.height);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
});

// ã‚«ãƒ¡ãƒ©
const camera = new THREE.PerspectiveCamera(
  25,
  sizes.width / sizes.height,
  0.1,
  100
);
camera.position.set(7, 7, 7);
scene.add(camera);

// ã‚ªãƒ¼ãƒ“ãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
const controls = new OrbitControls(camera, canvas);
controls.enableDamping = true;

// ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
const rendererParameters = {};
rendererParameters.clearColor = "#1d1f2a";

const renderer = new THREE.WebGLRenderer({
  canvas: canvas,
  antialias: true,
});
renderer.setClearColor(rendererParameters.clearColor);
renderer.setSize(sizes.width, sizes.height);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

gui.addColor(rendererParameters, "clearColor").onChange(() => {
  renderer.setClearColor(rendererParameters.clearColor);
});

const debugUIConfig = {
  color: "#70c1ff",
};

gui.addColor(debugUIConfig, "color").onChange(() => {
  material.uniforms.uColor.value.set(debugUIConfig.color);
});

// ãƒãƒ†ãƒªã‚¢ãƒ«
const material = new THREE.ShaderMaterial({
  vertexShader: vertexShader,
  fragmentShader: fragmentShader,
  uniforms: {
    uTime: new THREE.Uniform(0),
    uAnimationSpeed: new THREE.Uniform(0.03),
    uColor: new THREE.Uniform(new THREE.Color(debugUIConfig.color)),
  },
  transparent: true,
  side: THREE.DoubleSide,
  depthWrite: false,
  blending: THREE.AdditiveBlending,
});

// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
// Torus knot
const torusKnot = new THREE.Mesh(
  new THREE.TorusKnotGeometry(0.6, 0.25, 128, 32),
  material
);
torusKnot.position.x = 3;
scene.add(torusKnot);

// Sphere
const sphere = new THREE.Mesh(new THREE.SphereGeometry(), material);
sphere.position.x = -3;
scene.add(sphere);

// Suzanne
let suzanne = null;
gltfLoader.load("./suzanne.glb", (gltf) => {
  suzanne = gltf.scene;
  suzanne.traverse((child) => {
    if (child.isMesh) child.material = material;
  });
  scene.add(suzanne);
});

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const clock = new THREE.Clock();

const tick = () => {
  const elapsedTime = clock.getElapsedTime();
  material.uniforms.uTime.value = elapsedTime;

  if (suzanne) {
    suzanne.rotation.x = -elapsedTime * 0.1;
    suzanne.rotation.y = elapsedTime * 0.2;
  }

  sphere.rotation.x = -elapsedTime * 0.1;
  sphere.rotation.y = elapsedTime * 0.2;

  torusKnot.rotation.x = -elapsedTime * 0.1;
  torusKnot.rotation.y = elapsedTime * 0.2;

  controls.update();

  renderer.render(scene, camera);

  window.requestAnimationFrame(tick);
};

tick();
```

</details>

<details>
<summary>. glslãƒ•ã‚¡ã‚¤ãƒ«(ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)</summary>

```glsl
// vertex.glsl

uniform float uTime;

varying vec3 vPosition;
varying vec3 vNormal;

#include ../includes/random2D.glsl

void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);

  // ã‚°ãƒªãƒƒãƒåŠ¹æœ
  float glotchTime = uTime - modelPosition.y;
  float glitchStrength = sin(glotchTime) + sin(glotchTime * 2.354) + sin(glotchTime * 9.6436);
  glitchStrength /= 3.0;
  glitchStrength = smoothstep(0.3, 1.0, glitchStrength);
  glitchStrength *= 0.25;

  modelPosition.x += (random2D(modelPosition.xz + uTime) - 0.5) * glitchStrength;
  modelPosition.z += (random2D(modelPosition.zx + uTime) - 0.5) * glitchStrength;

  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectionPosition = projectionMatrix * viewPosition;

  gl_Position = projectionPosition;

    // ãƒ¢ãƒ‡ãƒ«ã®æ³•ç·š
  vec4 modelNormal = modelMatrix * vec4(normal, 0.0);

  // varying
  vPosition = modelPosition.xyz;
  vNormal = modelNormal.xyz;
}
```

```glsl
// fragment.glsl

uniform float uTime;
uniform float uAnimationSpeed;
uniform vec3 uColor;

varying vec3 vPosition;
varying vec3 vNormal;

void main() {

  // æ³•ç·š
  vec3 normal = normalize(vNormal);
  if(!gl_FrontFacing) {
    normal *= -1.0;
  }
  // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—
  float stripes = mod((vPosition.y - uTime * uAnimationSpeed) * 20.0, 1.0);
  stripes = pow(stripes, 3.0);

  // ãƒ•ãƒ¬ãƒãƒ«åŠ¹æœ
  vec3 viewDirection = normalize(vPosition - cameraPosition);
  float fresnel = dot(viewDirection, normal) + 1.0;
  fresnel = pow(fresnel, 2.0);

  // ãƒ•ã‚©ãƒ¼ãƒ«ã‚ªãƒ•
  float falloff = smoothstep(0.8, 0.0, fresnel);

  // ãƒ›ãƒ­ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯
  float holographic = stripes * fresnel;
  holographic += fresnel * 1.10;
  holographic *= falloff;

  gl_FragColor = vec4(vec3(uColor), holographic);

  // Three.js ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
}
```

```glsl
// random2D.glsl

float random2D(vec2 value) {
  return fract(sin(dot(value.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}
```

</details>
