---
source: "https://zenn.dev/hiraoku/articles/56f4f9ffc6d186"
published: 2025-06-15
created: 2026-01-07
---
#データ

# Git Worktreeをわかりやすく解説

Git Worktreeは、**一つのGitリポジトリに対して複数の作業ディレクトリ（ワーキングツリー）を持つことができる機能**です。これにより、異なるブランチでの作業を同時に行え、開発効率が向上します。

## Git Worktreeが便利な理由

*   **緊急修正への迅速な対応**: 現在の作業を中断せず、別の作業ツリーで緊急修正を行い、完了後に元の作業にすぐに戻れる。
    *   `git worktree add -b hotfix/critical-bug ../emergency main`
*   **複数機能の並行開発**: 複数の機能を同時に開発する際、それぞれの機能専用の作業環境を独立して持つことができる。
    *   `git worktree add ../auth-system feature/user-authentication`
*   **バージョン比較とデバッグ**: 異なるバージョンのコードを同時に開き、比較・デバッグ作業を効率的に行える。
    *   `git worktree add ../stable-version v2.1.0`

## 基本的な使い方

*   **新しいブランチを自動作成して作業開始**: `git worktree add ../feature-name`
*   **既存のブランチで作業開始**: `git worktree add ../work-folder existing-branch`
*   **ブランチ名を指定して作成**: `git worktree add -b new-branch-name ../folder-name`
*   **特定のコミットから新しいブランチを作成**: `git worktree add -b new-branch ../folder-name main`
*   **実験用の一時的な作業環境**: `git worktree add --detach ../experiment`

### Worktreeの状態確認と削除

*   **一覧表示**: `git worktree list`
*   **削除**: `git worktree remove ../folder-name` (未保存変更があると拒否)
*   **強制削除**: `git worktree remove --force ../folder-name` (注意が必要)
*   **不要な管理ファイルのクリーンアップ**: `git worktree prune` (定期的な実行を推奨)

## 注意点と制限

*   **サブモジュールのサポートが不完全**：スーパープロジェクトでの複数チェックアウトは非推奨。
*   **同じブランチの重複チェックアウトは通常不可**。
*   **クリーンでないworktreeは削除不可** ( `--force` が必要)。
*   **メインworktreeは削除できない**。

## ベストプラクティス

*   定期的な `git worktree prune` の実行。
*   Worktreeのパス名を用途がわかりやすいものにする。
*   強制オプション (`--force`) の慎重な使用。

## 筆者の推奨ワークフロー（追記）

当初`.git/worktrees/`内にworktreeを作成する方法を試したが、Gitが内部ファイルと混同し、作業中のファイルを`prunable`（削除可能）として扱ってしまう問題が発生。

現在は**親ディレクトリの兄弟ディレクトリとしてworktreeを作成する**方法を推奨。

### エイリアスの例 (`~/.gitconfig`)

```ini
[alias]
    # worktree追加（ブランチ名だけ指定）
    wta = \\"!f() { \\
        branch=\\\\"$1\\\\"; \\
        safe_branch=$(echo \\\\"$branch\\\\" | sed 's/\\\\//-/g'); \\
        path=\\\\"../$safe_branch\\\\"; \\
        if git show-ref --verify --quiet \\\\"refs/heads/$branch\\\\"; then \\
            git worktree add \\\\"$path\\\\" \\\\"$branch\\\\"; \\
        else \\
            git worktree add -b \\\\"$branch\\\\" \\\\"$path\\\\"; \\
        fi; \\
    }; f\\"
    
    # ブランチ名で削除（パスを探して削除）
    wtr = \\"!f() { \\
        branch=\\\\"$1\\\\"; \\
        worktree_path=$(git worktree list --porcelain | grep -B2 \\\\"branch refs/heads/$branch\\\\" | grep \\\\"worktree\\\\" | cut -d' ' -f2); \\
        if [ -n \\\\"$worktree_path\\\\" ]; then \\
            git worktree remove ${2:+--force} \\\\"$worktree_path\\\\"; \\
        else \\
            echo \\\\"Worktree for branch '$branch' not found\\\\"; \\
        fi; \\
    }; f\\"
    
    # 一覧表示
    wtl = worktree list
```

**使い方例**:

*   `git wta feature-x` (既存ブランチ)
*   `git wta -b new-feature` (新しいブランチ)
*   `git wtl` (一覧表示)
*   `git wtr feature-x` (削除)
*   `code -n ../feature-branch` (VSCodeで開く)

#Git #開発効率化 #Worktree